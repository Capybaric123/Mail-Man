<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mining Simulator</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #canvas { border: 1px solid #000; margin-top: 10px; }
        #controls { margin: 10px; }
        .material { margin: 5px 0; }
        .sell-buttons { margin-left: 10px; }
        #message { color: red; font-weight: bold; margin-bottom: 10px; }
        #timer { position: absolute; top: 10px; right: 10px; }
        #item-list { margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Mining Simulator</h1>
    <div id="message"></div>
    <div id="controls">
        <button id="buy-drill">Buy Drill ($50)</button>
        <button id="upgrade-drill">Upgrade Drill</button>
        <button id="buy-cooler">Buy Cooler ($200)</button>
        <label>
            <input type="checkbox" id="auto-sell"> Auto Sell Stone
        </label>
    </div>
    <div>
        <span>Money: $<span id="money">1000</span></span>
    </div>
    <div id="materials-list"></div>
    <canvas id="canvas" width="400" height="200"></canvas>
    <div id="timer">Time: 0s</div>
    <div id="item-list"></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let money = 1000;
        let drillLevel = 0;
        let drillCost = 50;
        let coolerCount = 0;
        let materials = {
            stone: { price: 5, quantity: 0 },
            coal: { price: 15, quantity: 0 },
            iron: { price: 50, quantity: 0 },
            magma: { price: 100, quantity: 0 },
            gold: { price: 150, quantity: 0 },
            diamond: { price: 1000, quantity: 0 },
            emerald: { price: 10000, quantity: 0 },
            ruby: { price: 100000, quantity: 0 }
        };

        let miningCooldown = false;
        let timeSpent = 0;

        const messageElement = document.getElementById('message');
        const timerElement = document.getElementById('timer');
        const itemListElement = document.getElementById('item-list');

        document.getElementById('buy-drill').addEventListener('click', buyDrill);
        document.getElementById('upgrade-drill').addEventListener('click', upgradeDrill);
        document.getElementById('buy-cooler').addEventListener('click', buyCooler);
        document.getElementById('auto-sell').addEventListener('change', toggleAutoSell);

        function buyDrill() {
            if (money >= drillCost) {
                money -= drillCost;
                drillLevel++;
                drillCost *= 2;
                updateDisplay();
                hideMessage(); // Hide message when drill is bought
            } else {
                showMessage("Not enough money to buy a drill!");
            }
            updateDrillButton();
        }

        function upgradeDrill() {
            if (money >= drillCost) {
                money -= drillCost;
                drillLevel++;
                drillCost *= 2;
                updateDisplay();
                updateDrillButton();
            } else {
                showMessage("Not enough money to upgrade the drill!");
            }
        }

        function buyCooler() {
            if (money >= 200 && coolerCount < drillLevel) {
                money -= 200;
                coolerCount++;
                updateDisplay();
                updateCoolerButton();
            } else {
                showMessage("Not enough money to buy a cooler or you have max coolers!");
            }
        }

        function toggleAutoSell() {
            if (this.checked) {
                setInterval(autoSellStone, 1000);
            }
        }

        function autoSellStone() {
            if (materials.stone.quantity > 0) {
                money += materials.stone.quantity * materials.stone.price;
                materials.stone.quantity = 0;
                updateDisplay();
            }
        }

        function mine() {
            if (drillLevel > 0 && !miningCooldown) {
                miningCooldown = true;
                const chances = calculateChances();
                const minedMaterial = getRandomMaterial(chances);
                materials[minedMaterial].quantity += Math.floor(Math.random() * 10) + 1;
                updateDisplay();
                setTimeout(() => miningCooldown = false, 1000); // 1 second cooldown
            } else if (drillLevel === 0) {
                showMessage("You need to buy a drill first!");
            }
        }

        function calculateChances() {
            const baseChances = {
                stone: 100,
                coal: 80,
                iron: 75,
                magma: 45,
                gold: 25,
                diamond: 13, // Decreased by 2%
                emerald: 5.4, // Decreased by 2%
                ruby: 1.2 // Decreased by 2%
            };

            const upgradeBonus = drillLevel; // 1% increase per upgrade
            return Object.fromEntries(Object.entries(baseChances).map(([material, chance]) => [material, chance + upgradeBonus]));
        }

        function getRandomMaterial(chances) {
            const total = Object.values(chances).reduce((sum, chance) => sum + chance, 0);
            const random = Math.random() * total;
            let cumulative = 0;

            for (const material in chances) {
                cumulative += chances[material];
                if (random < cumulative) {
                    return material;
                }
            }
        }

        function updateDisplay() {
            document.getElementById('money').textContent = money;
            renderMaterials();
            updateItemList();
        }

        function updateDrillButton() {
            document.getElementById('buy-drill').textContent = `Buy Drill ($${drillCost})`;
        }

        function updateCoolerButton() {
            document.getElementById('buy-cooler').disabled = coolerCount >= drillLevel;
        }

        function renderMaterials() {
            const materialsList = document.getElementById('materials-list');
            materialsList.innerHTML = '';
            for (const material in materials) {
                const div = document.createElement('div');
                div.className = 'material';
                div.textContent = `${material.charAt(0).toUpperCase() + material.slice(1)}: ${materials[material].quantity}`;

                const sellButtons = document.createElement('span');
                sellButtons.className = 'sell-buttons';
                
                const sell1 = createSellButton(material, 1);
                const sell10 = createSellButton(material, 10);
                const sellAll = createSellButton(material, materials[material].quantity);

                sellButtons.appendChild(sell1);
                sellButtons.appendChild(sell10);
                sellButtons.appendChild(sellAll);
                div.appendChild(sellButtons);

                materialsList.appendChild(div);
            }
        }

        function createSellButton(material, amount) {
            const button = document.createElement('button');
            button.textContent = `Sell ${amount}`;
            button.disabled = materials[material].quantity < amount;
            button.addEventListener('click', () => sellMaterial(material, amount));
            return button;
        }

        function sellMaterial(material, amount) {
            if (materials[material].quantity >= amount) {
                materials[material].quantity -= amount;
                money += materials[material].price * amount;
                updateDisplay();
            }
        }

        function updateItemList() {
            itemListElement.innerHTML = `
                <div>Drills Bought: ${drillLevel}</div>
                <div>Coolers Bought: ${coolerCount}</div>
            `;
        }

        function renderDrills() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < drillLevel; i++) {
                ctx.fillStyle = 'gray';
                ctx.fillRect(i * 30, 20, 20, 20);
            }
            for (let i = 0; i < coolerCount; i++) {
                ctx.fillStyle = 'blue';
                ctx.fillRect(i * 30, 0, 20, 20);
            }
        }

        setInterval(() => {
            mine();
            renderDrills();
        }, 1000);

        // Timer function
        setInterval(() => {
            timeSpent++;
            timerElement.textContent = `Time: ${timeSpent}s`;
        }, 1000);

        // Auto-save every minute
        setInterval(() => {
            localStorage.setItem('money', money);
            localStorage.setItem('drillLevel', drillLevel);
            localStorage.setItem('coolerCount', coolerCount);
            localStorage.setItem('materials', JSON.stringify(materials));
        }, 60000);

        // Load data from localStorage if it exists
        window.onload = function() {
            const savedMoney = localStorage.getItem('money');
            const savedDrillLevel = localStorage.getItem('drillLevel');
            const savedCoolerCount = localStorage.getItem('coolerCount');
            const savedMaterials = localStorage.getItem('materials');

            if (savedMoney) money = parseInt(savedMoney);
            if (savedDrillLevel) drillLevel = parseInt(savedDrillLevel);
            if (savedCoolerCount) coolerCount = parseInt(savedCoolerCount);
            if (savedMaterials) materials = JSON.parse(savedMaterials);

            updateDisplay();
            renderDrills();
            updateDrillButton();
            updateCoolerButton();
            if (drillLevel === 0) {
                showMessage("You need to buy your first drill!");
            }
        };

        function showMessage(msg) {
            messageElement.textContent = msg;
        }

        function hideMessage() {
            messageElement.textContent = '';
        }
    </script>
</body>
</html>
