<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mining Game</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #game { max-width: 600px; margin: auto; }
        #money, #timer { font-size: 24px; }
        button { margin: 5px; }
        #oreList { margin-top: 20px; }
        #counters { margin-top: 20px; }
        .ore-row { margin-bottom: 10px; position: relative; }
        .ore-color { height: 20px; margin-top: 5px; border-radius: 5px; }
        .stone { background-color: gray; }
        .coal { background-color: black; }
        .iron { background-color: lightgray; }
        .magma { background: linear-gradient(to right, orange, brown); }
        .diamond { background-color: lightblue; opacity: 0.5; }
        .emerald { background-color: green; opacity: 0.5; }
        .lazuli { background-color: blue; }
        .ruby { background-color: red; opacity: 0.5; }
    </style>
</head>
<body>
    <div id="game">
        <div id="money">Money: $1000</div>
        <div id="timer">Time: 0s</div>
        <div>
            <button id="buyDrill">Buy Drill (50$)</button>
            <button id="upgradeDrill">Upgrade Drills (100$)</button>
            <button id="buyCooler">Buy Cooler (200$)</button>
            <button id="autoSell">Toggle Auto Sell</button>
        </div>
        <div id="oreList"></div>
        <div id="counters">Miners: 0 | Upgrades: 0 | Coolers: 0</div>
    </div>

    <script>
        let money = 1000;
        let drills = 0;
        let coolerCount = 0;
        let upgrades = 0;
        let drillCooldown = 1000; // milliseconds
        let timer = 0;
        let autoSell = false;

        const ores = {
            stone: { price: 5, amount: 0 },
            coal: { price: 10, amount: 0 },
            iron: { price: 15, amount: 0 },
            magma: { price: 20, amount: 0 },
            diamond: { price: 100, amount: 0 },
            emerald: { price: 500, amount: 0 },
            lazuli: { price: 1000, amount: 0 },
            ruby: { price: 10000, amount: 0 },
        };

        function getRandomInt(max) {
            return Math.floor(Math.random() * max) + 1; // Random int from 1 to max
        }

        function saveGame() {
            const gameState = {
                money,
                drills,
                coolerCount,
                upgrades,
                drillCooldown,
                timer,
                autoSell,
                ores
            };
            localStorage.setItem('miningGameSave', JSON.stringify(gameState));
        }

        function loadGame() {
            const savedGame = localStorage.getItem('miningGameSave');
            if (savedGame) {
                const gameState = JSON.parse(savedGame);
                money = gameState.money;
                drills = gameState.drills;
                coolerCount = gameState.coolerCount;
                upgrades = gameState.upgrades;
                drillCooldown = gameState.drillCooldown;
                timer = gameState.timer;
                autoSell = gameState.autoSell;
                Object.assign(ores, gameState.ores);  // Restore ore amounts
                updateDisplay();
            }
        }

        function updateDisplay() {
            document.getElementById('money').innerText = `Money: $${money}`;
            document.getElementById('timer').innerText = `Time: ${timer}s`;
            document.getElementById('counters').innerText = `Miners: ${drills} | Upgrades: ${upgrades} | Coolers: ${coolerCount}`;
            document.getElementById('oreList').innerHTML = '';
            Object.entries(ores).forEach(([ore, data]) => {
                const oreRow = document.createElement('div');
                oreRow.classList.add('ore-row');
                oreRow.innerHTML = `
                    ${ore.charAt(0).toUpperCase() + ore.slice(1)}: $${data.price} for 10 | Amount: ${data.amount} 
                    <button onclick="sellOre('${ore}', 1)">Sell 1</button>
                    <button onclick="sellOre('${ore}', 10)">Sell 10</button>
                    <button onclick="sellOre('${ore}', data.amount)">Sell All</button>
                `;

                // Create a colored rectangle for the ore
                const colorDiv = document.createElement('div');
                colorDiv.classList.add('ore-color', ore);
                oreRow.appendChild(colorDiv);

                document.getElementById('oreList').appendChild(oreRow);
            });
        }

        function mine() {
            if (drills > 0) {
                for (let i = 0; i < drills; i++) {
                    let roll = Math.random();

                    // Base drop chances for each ore
                    let rubyChance = 0.000001;
                    let lazuliChance = 0.00001;
                    let emeraldChance = 0.0001;
                    let diamondChance = 0.001;
                    let magmaChance = 0.003;
                    let ironChance = 0.006;
                    let coalChance = 0.09;

                    // Increase chances for rarer ores based on upgrades
                    rubyChance += upgrades * 0.000005;   // Increase by 0.05% per upgrade
                    lazuliChance += upgrades * 0.00005;
                    emeraldChance += upgrades * 0.0005;
                    diamondChance += upgrades * 0.005;

                    // Determine quantity mined
                    const quantityMined = getRandomInt(10);

                    if (roll < rubyChance) ores.ruby.amount += quantityMined;
                    else if (roll < lazuliChance) ores.lazuli.amount += quantityMined;
                    else if (roll < emeraldChance) ores.emerald.amount += quantityMined;
                    else if (roll < diamondChance) ores.diamond.amount += quantityMined;
                    else if (roll < magmaChance) ores.magma.amount += quantityMined;
                    else if (roll < ironChance) ores.iron.amount += quantityMined;
                    else if (roll < coalChance) ores.coal.amount += quantityMined;
                    else ores.stone.amount += quantityMined;
                }
                if (autoSell) {
                    sellAllOres();
                }
            }
            updateDisplay();
        }

        function sellOre(ore, quantity) {
            if (ores[ore].amount >= quantity) {
                ores[ore].amount -= quantity;
                money += ores[ore].price * quantity;
                updateDisplay();
            }
        }

        function sellAllOres() {
            for (const ore of Object.keys(ores)) {
                const amountToSell = ores[ore].amount;
                money += ores[ore].price * amountToSell;
                ores[ore].amount = 0;
            }
            updateDisplay();
        }

        function startTimer() {
            setInterval(() => {
                timer++;
                updateDisplay();
            }, 1000);
        }

        document.getElementById('buyDrill').onclick = () => {
            if (money >= 50) {
                drills++;
                money -= 50;
                updateDisplay();
            }
        };

        document.getElementById('upgradeDrill').onclick = () => {
            if (money >= 100) {
                drillCooldown = Math.max(800, drillCooldown - 200);
                money -= 100;
                upgrades++;
                updateDisplay();
            }
        };

        document.getElementById('buyCooler').onclick = () => {
            if (money >= 200) {
                coolerCount++;
                drillCooldown = Math.max(800, drillCooldown - 200);
                money -= 200;
                updateDisplay();
            }
        };

        document.getElementById('autoSell').onclick = () => {
            autoSell = !autoSell;
            document.getElementById('autoSell').innerText = autoSell ? "Disable Auto Sell" : "Enable Auto Sell";
        };

        // Auto-save every second
        setInterval(saveGame, 1000);

        // Load the game state on startup
        loadGame();

        startTimer();
        setInterval(mine, drillCooldown);
        updateDisplay();
    </script>
</body>
</html>
